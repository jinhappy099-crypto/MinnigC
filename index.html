<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miner Clicker PickCoin</title>
<style>
body {margin:0; background:#111; color:white; font-family:Arial; display:flex; flex-direction:row; height:100vh;}
#sidePanel {width:200px; background:#222; display:flex; flex-direction:column; align-items:center; padding:10px;}
#sidePanel label {margin-top:20px; font-weight:bold;}
#mainArea {flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; position:relative;}
#logo {width:180px; margin-top:10px;}
#wallet, #counter {color:gold; font-weight:bold; margin:5px 0;}
#mineral {width:150px; margin-top:20px; image-rendering:pixelated; transition:.1s;}
#pickaxe {position:absolute; bottom:15px; left:15px; width:100px; image-rendering:pixelated; transition:.1s;}
#hp-bar {width:60%; height:10px; margin-top:10px; background:#222; border-radius:6px;}
#hp {height:100%; background:lime; border-radius:6px; transition:width .15s;}
#inventory {width:400px; height:400px; margin-top:20px; display:grid; grid-template-columns:repeat(5,1fr); gap:3px;}
.slot {background:#333; border:1px solid #444; display:flex; justify-content:center; align-items:center; position:relative; cursor:pointer;}
.slot.selected {border:2px solid lime;}
.slot img {width:50px; image-rendering:pixelated;}
.qty {position:absolute; bottom:2px; right:2px; background:rgba(0,0,0,.6); padding:1px 3px; border-radius:3px; font-size:12px;}
#xp-bar {width:60%; height:12px; background:#222; border-radius:6px; margin-top:10px; overflow:hidden;}
#xp-fill {height:100%; width:0%; background:gold; transition:width .2s;}
#level-display {margin-top:5px; font-weight:bold;}
/* Raretés */
.common {border:2px solid gray;}
.rare {border:2px solid blue;}
.epic {border:2px solid purple;}
.legendary {border:2px solid orange;}
</style>
</head>
<body>

<div id="sidePanel">
  <img id="logo" src="logo.png">
  <label><input type="checkbox" id="confirmToggle" checked> Confirmation d'échange</label>
  <div id="wallet">PickCoin: $0</div>
  <div id="counter">Minerais minés: 0</div>
</div>

<div id="mainArea">
  <img id="mineral" src="stone.png" alt="mineral">
  <img id="pickaxe" src="pickaxe.png" alt="pickaxe">
  <div id="hp-bar"><div id="hp"></div></div>
  <div id="xp-bar"><div id="xp-fill"></div></div>
  <div id="level-display">Niveau : 1</div>
  <div id="inventory"></div>
</div>

<script>
// ===== Variables =====
const SIZE = 25; 
const MAX_STACK = 64;
let inventory = Array(SIZE).fill(null);
let selected = null;

// Joueur / Niveau
let playerLevel = 1;
let xp = 0;
let xpNeeded = 50;
let pickaxeBonus = 1; 
let comboDuration = 2000; 

// Combo
let combo = 0;
let comboTimer;

// Wallet
let pickCoin = 0;

// Compteur total de minerais
let totalMined = 0;

// Minéraux avec PV et drops max
const MINERALS = [
  {id:"stone", name:"Pierre", img:"stone.png", hp:3, rarity:"common", baseQty:1, maxQty:5},
  {id:"coal", name:"Charbon", img:"coal.png", hp:4, rarity:"common", baseQty:1, maxQty:5},
  {id:"iron", name:"Fer", img:"iron.png", hp:6, rarity:"rare", baseQty:1, maxQty:3},
  {id:"gold", name:"Or", img:"gold.png", hp:8, rarity:"epic", baseQty:1, maxQty:2},
  {id:"diamond", name:"Diamant", img:"diamond.png", hp:12, rarity:"legendary", baseQty:1, maxQty:1}
];

// Bourse fictive pour prix PickCoin
const PRICE_TABLE = {
  common: [1,3],
  rare: [5,10],
  epic: [15,25],
  legendary: [50,100]
};

let current, hp, canMine=true;
const mineralEl=document.getElementById("mineral");
const pickaxeEl=document.getElementById("pickaxe");
const hpEl=document.getElementById("hp");
const inventoryEl=document.getElementById("inventory");
const xpFill=document.getElementById("xp-fill");
const levelDisplay=document.getElementById("level-display");
const walletEl=document.getElementById("wallet");
const counterEl=document.getElementById("counter");
const confirmToggle=document.getElementById("confirmToggle");

// ===== Fonctions =====
function spawnMineral() {
  current = MINERALS[Math.floor(Math.random()*MINERALS.length)];
  mineralEl.src = current.img;
  mineralEl.className = current.rarity;
  hp = current.hp;
  hpEl.style.width="100%";
}

function addItem(mineral) {
  let bonus = Math.floor(Math.random() * Math.min(combo,3)) +1;
  let amount = Math.min(mineral.baseQty + bonus, mineral.maxQty);
  totalMined += amount;
  counterEl.textContent = "Minerais minés: " + totalMined;

  let i = inventory.findIndex(s=>s && s.id===mineral.id && s.qty<MAX_STACK);
  if(i!==-1){
    inventory[i].qty = Math.min(inventory[i].qty + amount, MAX_STACK);
    buildInventory(); 
    return;
  }
  let empty = inventory.findIndex(s=>!s);
  if(empty===-1){ alert("Inventaire plein !"); return; }
  inventory[empty] = {...mineral, qty:amount};
  buildInventory();
}

function exchangeItem(i){
  if(!inventory[i]) return;
  const item = inventory[i];
  let proceed = true;
  
  if(confirmToggle.checked){
    proceed = confirm(`Échanger ${item.qty} ${item.name} contre PickCoin ?`);
  }
  
  if(proceed){
    let range = PRICE_TABLE[item.rarity];
    let price = Math.floor(Math.random()*(range[1]-range[0]+1)) + range[0];
    price *= item.qty;
    pickCoin += price;
    walletEl.textContent = "PickCoin: $" + pickCoin;
    inventory[i] = null;
    buildInventory();
    alert(`${item.qty} ${item.name} échangés contre $${price} PickCoin !`);
  }
}

function buildInventory() {
  inventoryEl.innerHTML="";
  inventory.forEach((item,i)=>{
    const slot=document.createElement("div");
    slot.className="slot";
    if(i===selected) slot.classList.add("selected");
    if(item){
      const img=document.createElement("img");
      img.src=item.img;
      slot.appendChild(img);
      if(item.qty>1){
        const q=document.createElement("div");
        q.className="qty"; q.textContent="x"+item.qty;
        slot.appendChild(q);
      }
      slot.onclick=()=>{ selected=i; exchangeItem(i); };
    } else {
      slot.onclick=()=>{ selected=i; };
    }
    inventoryEl.appendChild(slot);
  });
}

mineralEl.onclick = () => {
  if(!canMine) return;
  canMine=false;
  hp -= pickaxeBonus;
  mineralEl.style.transform="scale(.92)";
  pickaxeEl.style.transform="rotate(-25deg)";
  setTimeout(()=>{ mineralEl.style.transform=""; pickaxeEl.style.transform=""; },120);
  hpEl.style.width=(hp/current.hp*100)+"%";

  combo++;
  clearTimeout(comboTimer);
  comboTimer=setTimeout(()=>{combo=0;},comboDuration);

  mineralEl.style.filter="brightness(1.3)";
  setTimeout(()=>{mineralEl.style.filter="";},100);

  if(hp<=0){ addItem(current); gainXP(5); spawnMineral(); }

  setTimeout(()=>canMine=true,200);
};

function gainXP(amount) {
  xp += amount;
  xpFill.style.width=Math.min(100,(xp/xpNeeded*100))+"%";
  if(xp>=xpNeeded){
    xp = 0;
    playerLevel++;
    xpNeeded = Math.floor(xpNeeded*1.3);
    pickaxeBonus++; 
    comboDuration+=200;
    alert("Niveau UP ! Niveau : "+playerLevel);
    levelDisplay.textContent="Niveau : "+playerLevel;
    xpFill.style.width="0%";
  }
}

// ===== Initialisation =====
spawnMineral();
buildInventory();
levelDisplay.textContent="Niveau : "+playerLevel;
</script>

</body>
</html>